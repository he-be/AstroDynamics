=== Lambert Solver vs Reality Check ===
Loading Ephemeris kernels... (this may take a while on first run)
Transfer: 2025-08-31T16:00:00Z -> 2025-09-06T16:00:00Z (6.0 days)
R1 (Ganymede): 1067875.6 km
R2 (Callisto): 1882549.3 km
Using Mu_Jupiter: 126686534.0

[Test 1] Lambert vs Kepler Propagator (2-Body Checks)
  Target  : [-335939.06631341 1677533.45663147  785505.08102138]
  Actual  : [-335939.21846745 1677533.41206073  785505.05983065]
  Error   : 0.2 km
  -> PASS: Lambert solver is mathematically consistent.

[Test 2] Lambert vs N-Body (JAX Engine)

[Debug] Initial Acceleration Magnitude: 1.826e+01 km/s^2
  -> WARNING: Acceleration is HUGE! Collision or Frame Mismatch?
Traceback (most recent call last):
  File "/Users/mh/dev/AstroDynamics/tests/test_lambert_fidelity.py", line 140, in <module>
    test_lambert_fidelity()
  File "/Users/mh/dev/AstroDynamics/tests/test_lambert_fidelity.py", line 119, in test_lambert_fidelity
    sol = jax_engine.propagate(
  File "/Users/mh/dev/AstroDynamics/universe/jax_engine.py", line 160, in propagate
    sol = diffeqsolve(
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/diffrax/_integrate.py", line 1416, in diffeqsolve
    final_state, aux_stats = adjoint.loop(
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/equinox/_module/_prebuilt.py", line 33, in __call__
    return self.__func__(self.__self__, *args, **kwargs)
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/diffrax/_adjoint.py", line 299, in loop
    final_state = self._loop(
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/diffrax/_integrate.py", line 638, in loop
    final_state = outer_while_loop(
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/contextlib.py", line 81, in inner
    return func(*args, **kwds)
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/equinox/internal/_loop/loop.py", line 107, in while_loop
    return checkpointed_while_loop(
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/equinox/internal/_loop/checkpointed.py", line 247, in checkpointed_while_loop
    body_fun_ = filter_closure_convert(body_fun_, init_val_)
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/equinox/internal/_loop/common.py", line 511, in new_body_fun
    buffer_val2 = body_fun(buffer_val)
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/diffrax/_integrate.py", line 635, in body_fun
    new_state, _, _ = body_fun_aux(state)
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/diffrax/_integrate.py", line 425, in body_fun_aux
    interpolator = solver.interpolation_cls(
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/equinox/_module/_module.py", line 414, in __call__
    self = super().__call__(*args, **kwargs)  # pyright: ignore[reportAttributeAccessIssue]
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/equinox/_module/_better_abstract.py", line 233, in __call__
    self = super().__call__(*args, **kwargs)
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/diffrax/_local_interpolation.py", line 124, in __init__
    self.coeffs = jtu.tree_map(_calculate, y0, y1, k)
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/diffrax/_local_interpolation.py", line 120, in _calculate
    return jnp.stack([_a, _b, _c, _f0, _y0])
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/jax/_src/numpy/lax_numpy.py", line 4433, in stack
    return concatenate(new_arrays, axis=axis, dtype=dtype)
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/jax/_src/numpy/lax_numpy.py", line 4604, in concatenate
    arrays_out = [lax.concatenate(arrays_out[i:i+k], axis)
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/jax/_src/numpy/lax_numpy.py", line 4604, in <listcomp>
    arrays_out = [lax.concatenate(arrays_out[i:i+k], axis)
jax._src.source_info_util.JaxStackTraceBeforeTransformation: KeyboardInterrupt

The preceding stack trace is the source of the JAX operation that, once transformed by JAX, triggered the following exception.

--------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/mh/dev/AstroDynamics/tests/test_lambert_fidelity.py", line 140, in <module>
    test_lambert_fidelity()
  File "/Users/mh/dev/AstroDynamics/tests/test_lambert_fidelity.py", line 119, in test_lambert_fidelity
    sol = jax_engine.propagate(
          ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mh/dev/AstroDynamics/universe/jax_engine.py", line 160, in propagate
    sol = diffeqsolve(
          ^^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/equinox/_jit.py", line 209, in __call__
    return _call(self, False, args, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/equinox/_jit.py", line 263, in _call
    marker, _, _ = out = jit_wrapper._cached(
                         ^^^^^^^^^^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/equinox/_jit.py", line 55, in fun_wrapped
    out = fun(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/diffrax/_integrate.py", line 1416, in diffeqsolve
    final_state, aux_stats = adjoint.loop(
                             ^^^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/equinox/_module/_prebuilt.py", line 33, in __call__
    return self.__func__(self.__self__, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/diffrax/_adjoint.py", line 299, in loop
    final_state = self._loop(
                  ^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/diffrax/_integrate.py", line 638, in loop
    final_state = outer_while_loop(
                  ^^^^^^^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/contextlib.py", line 81, in inner
    return func(*args, **kwds)
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/equinox/internal/_loop/loop.py", line 107, in while_loop
    return checkpointed_while_loop(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/equinox/internal/_loop/checkpointed.py", line 249, in checkpointed_while_loop
    final_val_ = _checkpointed_while_loop(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/equinox/_ad.py", line 1101, in __call__
    out = self.fn_wrapped(
          ^^^^^^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/jax/_src/traceback_util.py", line 195, in reraise_with_filtered_traceback
    return fun(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/jax/_src/custom_derivatives.py", line 749, in __call__
    out_flat = custom_vjp_call_p.bind(flat_fun, flat_fwd, flat_bwd,
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/jax/_src/custom_derivatives.py", line 1001, in bind
    return self._true_bind(*args, **params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/jax/_src/core.py", line 648, in _true_bind
    return self.bind_with_trace(prev_trace, args, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/jax/_src/custom_derivatives.py", line 1005, in bind_with_trace
    return trace.process_custom_vjp_call(self, fun, fwd, bwd, tracers, **params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/jax/_src/core.py", line 1210, in process_custom_vjp_call
    return fun.call_wrapped(*tracers)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/jax/_src/linear_util.py", line 212, in call_wrapped
    return self.f_transformed(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/jax/_src/custom_derivatives.py", line 87, in _flatten_fun_nokwargs
    ans = f(*py_args)
          ^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/jax/_src/custom_derivatives.py", line 759, in _check_primal_refs
    out = f(*args)
          ^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/jax/_src/api_util.py", line 292, in _argnums_partial
    return _fun(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/jax/_src/linear_util.py", line 421, in _get_result_paths_thunk
    ans = _fun(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/equinox/_ad.py", line 1006, in fn_wrapped
    out = self.fn(vjp_arg, *args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/equinox/internal/_loop/checkpointed.py", line 271, in _checkpointed_while_loop
    return while_loop(lambda x: cond_fun(x), lambda x: body_fun(x), init_val)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/contextlib.py", line 81, in inner
    return func(*args, **kwds)
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/jax/_src/traceback_util.py", line 195, in reraise_with_filtered_traceback
    return fun(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/jax/_src/lax/control_flow/loops.py", line 1694, in while_loop
    val = tree_map(lax.asarray, body_fun(val))
                                ^^^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/equinox/internal/_loop/checkpointed.py", line 271, in <lambda>
    return while_loop(lambda x: cond_fun(x), lambda x: body_fun(x), init_val)
                                                       ^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/equinox/_ad.py", line 615, in __call__
    out_dynamic_flat = jax.core.eval_jaxpr(
                       ^^^^^^^^^^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/jax/_src/core.py", line 747, in eval_jaxpr
    ans = eqn.primitive.bind(*subfuns, *map(read, eqn.invars), **bind_params)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/jax/_src/core.py", line 632, in bind
    return self._true_bind(*args, **params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/jax/_src/core.py", line 648, in _true_bind
    return self.bind_with_trace(prev_trace, args, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/jax/_src/core.py", line 660, in bind_with_trace
    return trace.process_primitive(self, args, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/jax/_src/core.py", line 1189, in process_primitive
    return primitive.impl(*args, **params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/mh/miniforge3/envs/astro_env/lib/python3.11/site-packages/jax/_src/dispatch.py", line 92, in apply_primitive
    outs = fun(*args)
           ^^^^^^^^^^
KeyboardInterrupt
